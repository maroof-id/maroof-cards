#!/usr/bin/env python3
import nfc
import time
import sys

print("?? ?????? CH340 NFC Reader")
print("=" * 50)

# ????? ???? ??? ttyUSB0
transports = [
    'tty:/dev/ttyUSB0:pn532',
    'tty:USB0:pn532',
    'tty:/dev/ttyUSB0',
]

for transport in transports:
    try:
        print(f"\n? ??????: {transport}")
        clf = nfc.ContactlessFrontend(transport)
        
        print(f"? ??? ???????!")
        print(f"?? ??????: {clf}")
        print(f"\n?? ?????? ??? ??????: '{transport}'")
        
        # ?????? ????? ?????
        print("\n?? ?? ????? NFC ???? (5 ?????)...")
        tag = clf.connect(rdwr={'on-connect': lambda t: False})
        
        if tag:
            print(f"? ?? ?????? ?????: {tag}")
            if tag.ndef:
                print(f"?? ????????: {tag.ndef.records}")
        else:
            print("?? ?? ??? ?????? ????? (????? ?????)")
        
        clf.close()
        sys.exit(0)
        
    except Exception as e:
        print(f"? ???: {e}")
        time.sleep(1)

print("\n" + "=" * 50)
print("? ??? ??????? ??? ???? ???????")
print("\n?? ???? ??:")
print("   1. ?????? ???? ?????")
print("   2. ?????? ?? ??? UART (???? ?? ?????? DIP)")
print("   3. ???? ???????? (baud rate) ????")
